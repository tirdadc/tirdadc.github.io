<!doctype html>
<html>
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">

    <!-- Use title if it's in the page YAML frontmatter -->
    <title>Postgres Reminder</title>

    <link href='//fonts.googleapis.com/css?family=Open+Sans:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>

    <link href="/stylesheets/site.css" rel="stylesheet" />
    <link href="/stylesheets/highlighting.css" rel="stylesheet" />
    <script src="/javascripts/all.js"></script>
  </head>

  <div class="blog blog_2016 blog_2016_10 blog_2016_10_26 blog_2016_10_26_postgres-reminder blog_2016_10_26_postgres-reminder_index">
    <div class="header">
      <h1><a href='/'>tirdadc</a></h1>
      <h2>Web Development | Ruby on Rails | React.js</h2>
    </div>
    <article>
      <h3>Postgres Reminder</h3>
      <time>Oct 26 2016</time>
      <p>Finally moving this out of <code>notes.txt</code> into the blog for future reference.</p>

<p>To kill a connection:</p>
<pre class="highlight sql"><code><span class="k">SELECT</span> <span class="n">pid</span> <span class="k">FROM</span> <span class="n">pg_stat_activity</span> <span class="k">where</span> <span class="n">pid</span> <span class="o">&lt;&gt;</span> <span class="n">pg_backend_pid</span><span class="p">();</span>
<span class="k">SELECT</span> <span class="n">pg_terminate_backend</span><span class="p">(</span><span class="err">$</span><span class="mi">1</span><span class="p">);</span>
</code></pre>
<p>To dump a database into a SQL-script file:</p>
<pre class="highlight sql"><code><span class="n">pg_dump</span> <span class="n">db_name</span> <span class="o">&gt;</span> <span class="n">outfile</span><span class="p">.</span><span class="k">sql</span>
</code></pre>
<p>To dump a database into a compressed file:</p>
<pre class="highlight sql"><code><span class="n">pg_dump</span> <span class="o">-</span><span class="n">Fc</span> <span class="n">db_name</span> <span class="o">&gt;</span> <span class="n">outfile</span><span class="p">.</span><span class="n">dump</span>
</code></pre>
<p>To restore a database:</p>
<pre class="highlight sql"><code><span class="n">psql</span> <span class="n">db_name</span> <span class="o">&lt;</span> <span class="n">infile</span><span class="p">.</span><span class="k">sql</span>
</code></pre>
<p>To grant all privileges to a user:</p>
<pre class="highlight sql"><code><span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">PRIVILEGES</span> <span class="k">ON</span> <span class="k">DATABASE</span> <span class="n">db_name</span> <span class="k">TO</span> <span class="n">db_user</span><span class="p">;</span>
</code></pre>
<p>log in as admin :</p>
<pre class="highlight sql"><code><span class="n">psql</span> <span class="o">-</span><span class="n">U</span> <span class="n">postgres</span>
</code></pre>
<p>change owner of database:</p>
<pre class="highlight sql"><code><span class="k">ALTER</span> <span class="k">DATABASE</span> <span class="n">name</span> <span class="k">OWNER</span> <span class="k">TO</span> <span class="n">new_owner</span><span class="p">;</span>
</code></pre>
<p>Change a user&rsquo;s password:</p>
<pre class="highlight sql"><code><span class="k">ALTER</span> <span class="k">USER</span> <span class="nv">"user_name"</span> <span class="k">WITH</span> <span class="n">PASSWORD</span> <span class="s1">'new_password'</span><span class="p">;</span>
</code></pre>
<p>To view all users:</p>
<pre class="highlight sql"><code><span class="err">\</span><span class="n">du</span>
</code></pre>
<p>To connect to a database as a specific user:</p>
<pre class="highlight sql"><code><span class="n">psql</span> <span class="o">-</span><span class="n">d</span> <span class="n">database_name</span> <span class="o">-</span><span class="n">U</span> <span class="k">user</span>
</code></pre>
<p>To change a database&rsquo;s owner:</p>
<pre class="highlight sql"><code><span class="k">ALTER</span> <span class="k">DATABASE</span> <span class="n">name</span> <span class="k">OWNER</span> <span class="k">TO</span> <span class="n">new_owner</span><span class="p">;</span>
</code></pre>
    </article>
  </div>
  <footer>
  <div>Â© 2016 Tirdad C.</div>
  <div>
    <a href="/about/">About</a> |
    <a href="http://stackoverflow.com/users/3102766/tirdadc">Stack Overflow</a> |
    <a href="https://github.com/tirdadc">GitHub</a>
  </div>
</footer>

</html>
